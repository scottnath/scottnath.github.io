<!DOCTYPE html><html lang="en"> <head><script defer data-domain="scottnath.com" src="https://plausible.io/js/script.js" type="text/partytown"></script> <script type="text/partytown" defer data-domain="scottnath.com" src="https://plausible.io/js/script.outbound-links.js"></script> <!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-mind-blown.ico" id="favicon"><meta name="generator" content="Astro v4.4.2"><link rel="preload" as="image" href="/scott-nath-profile-pic.jpeg"><!-- Canonical URL --><link rel="canonical" href="https://scottnath.com/blahg/sharing-tests-between-javascript-frameworks/"><!-- Primary Meta Tags --><title>Sharing UI Tests Between Javascript Frameworks</title><meta name="title" content="Sharing UI Tests Between Javascript Frameworks"><meta name="description" content="How to share testing-library UI tests between Javascript frameworks with the same or similar components and use them in Storybook and unit testing."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://scottnath.com/blahg/sharing-tests-between-javascript-frameworks/"><meta property="og:title" content="Sharing UI Tests Between Javascript Frameworks"><meta property="og:description" content="How to share testing-library UI tests between Javascript frameworks with the same or similar components and use them in Storybook and unit testing."><meta property="og:image" content="https://scottnath.com/js-framework-share-tests.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://scottnath.com/blahg/sharing-tests-between-javascript-frameworks/"><meta property="twitter:title" content="Sharing UI Tests Between Javascript Frameworks"><meta property="twitter:description" content="How to share testing-library UI tests between Javascript frameworks with the same or similar components and use them in Storybook and unit testing."><meta property="twitter:image" content="https://scottnath.com/js-framework-share-tests.png"><link rel="stylesheet" href="/_astro/_slug_.Xn3YLocu.css" />
<style>@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0}}@keyframes astroFadeOut{to{opacity:0}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-old(*),::view-transition-new(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}
</style><script type="module">const e=()=>{const i=document.querySelector("#favicon");if(document.hidden){const n=i?.href;document.initialFavicon=n,i.href="/favicon-clown.ico"}else document.initialFavicon!==""&&(i.href=document.initialFavicon)};document.addEventListener("visibilitychange",e,!0);document.initialFavicon=document.querySelector("#favicon").href;
</script>
<script>!(function(w,p,f,c){c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.8.0 - MIT builder.io */
!function(t,e,n,i,r,o,a,d,s,c,l,p){function u(){p||(p=1,"/"==(a=(o.lib||"/~partytown/")+(o.debug?"debug/":""))[0]&&(s=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(f,1e4),e.addEventListener("pt0",w),r?h(1):n.serviceWorker?n.serviceWorker.register(a+(o.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):f())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.setAttribute("style","display:block;width:0;height:0;border:0;visibility:hidden"),c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.8.0":"sandbox-sw.html?"+Date.now()),e.querySelector(o.sandboxParent||"body").appendChild(c)}function f(n,r){for(w(),i==t&&(o.forward||[]).map((function(e){delete t[e.split(".")[0]]})),n=0;n<s.length;n++)(r=e.createElement("script")).innerHTML=s[n].innerHTML,e.head.appendChild(r);c&&c.parentNode.removeChild(c)}function w(){clearTimeout(d)}o=t.partytown||{},i==t&&(o.forward||[]).map((function(e){l=t,e.split(".").map((function(e,n,i){l=l[i[n]]=n+1<i.length?"push"==i[n+1]?[]:l[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);;((d,s)=>(s=d.currentScript,d.addEventListener('astro:before-swap',()=>s.remove(),{once:true})))(document);</script><style>[data-astro-transition-scope="astro-x5ucuxqb-1"] { view-transition-name: astro-x5ucuxqb-1; }@layer astro { ::view-transition-old(astro-x5ucuxqb-1) { 
	animation-duration: 90ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both, both;
	animation-name: astroFadeOut, astroSlideToLeft; }::view-transition-new(astro-x5ucuxqb-1) { 
	animation-duration: 210ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-delay: 30ms;
	animation-fill-mode: both, both;
	animation-name: astroFadeIn, astroSlideFromRight; }[data-astro-transition=back]::view-transition-old(astro-x5ucuxqb-1) { 
	animation-name: astroFadeOut, astroSlideToRight; }[data-astro-transition=back]::view-transition-new(astro-x5ucuxqb-1) { 
	animation-name: astroFadeIn, astroSlideFromLeft; } }[data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x5ucuxqb-1"],
			[data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x5ucuxqb-1"] { 
	animation-duration: 90ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-fill-mode: both, both;
	animation-name: astroFadeOut, astroSlideToLeft; }[data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x5ucuxqb-1"],
			[data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x5ucuxqb-1"] { 
	animation-duration: 210ms, 220ms;
	animation-timing-function: cubic-bezier(0.76, 0, 0.24, 1), cubic-bezier(0.76, 0, 0.24, 1);
	animation-delay: 30ms;
	animation-fill-mode: both, both;
	animation-name: astroFadeIn, astroSlideFromRight; }[data-astro-transition=back][data-astro-transition-fallback="old"] [data-astro-transition-scope="astro-x5ucuxqb-1"],
			[data-astro-transition=back][data-astro-transition-fallback="old"][data-astro-transition-scope="astro-x5ucuxqb-1"] { 
	animation-name: astroFadeOut, astroSlideToRight; }[data-astro-transition=back][data-astro-transition-fallback="new"] [data-astro-transition-scope="astro-x5ucuxqb-1"],
			[data-astro-transition=back][data-astro-transition-fallback="new"][data-astro-transition-scope="astro-x5ucuxqb-1"] { 
	animation-name: astroFadeIn, astroSlideFromLeft; }</style></head> <body> <header data-astro-cid-3ef6ksr2> <dope-stripes data-astro-cid-fb7ufwnd> <template shadowrootmode="open" data-astro-cid-fb7ufwnd><style>.stripes{width:100%;--left-width: 20%;--angle-width: 50px;--stripe-height: 20px;--stripe-angle: 39deg}.stripe{display:flex;align-items:left;margin:0 0 -1px;width:100%;--stripe-color: #ffe27a}.stripe span,.stripe:before,.stripe:after{content:" ";height:var(--stripe-height);display:block;background-color:var(--stripe-color);--rotated-height: calc(var(--angle-width) * tan(var(--stripe-angle)))}.stripe span{transform:skewY(var(--stripe-angle));transform-origin:0% 0%;flex:0 0 auto;width:calc(var(--angle-width));height:var(--stripe-height)}.stripe:before{width:var(--left-width);flex:0 0 auto}.stripe:after{flex:1 1 auto;transform:translateY(var(--rotated-height))}.blue{--stripe-color: rgb(0, 0, 255)}.yellow{--stripe-color: #ffe27a}.orange{--stripe-color: #ffa64d}.dark-orange{--stripe-color: #ff7f1a}</style><div class="stripes" part="stripes">
    <div class="stripe" style="--stripe-color: #ffd273"><span></span></div><div class="stripe" style="--stripe-color: #ffbf57"><span></span></div><div class="stripe" style="--stripe-color: #ffa43b"><span></span></div><div class="stripe" style="--stripe-color: #ff8920"><span></span></div><div class="stripe" style="--stripe-color: #ff6e05"><span></span></div>
  </div></template> </dope-stripes>  <div class="content" data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2> Scott Nath </h2> <h3 data-astro-cid-3ef6ksr2>Front-end architect</h3> <img src="/_astro/scott-nath-profile-photo.B_h8QufM.jpeg" alt="Scott Nath picture" width="400" height="400" class="avatar" data-astro-cid-3ef6ksr2> <nav data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Home </a>  <a href="/blahg" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Blahg </a>  <a href="/resume" data-astro-cid-3ef6ksr2 data-astro-cid-eimmu3lg> Resume </a>  </nav> <address class="socials" aria-label="Also find me on these sites" data-astro-cid-3ef6ksr2> <a rel="me" href="https://dev.to/scottnath" data-astro-cid-3ef6ksr2><img src="/_astro/dev.DPyAJ8Ri.svg" alt="DEV logo" data-astro-cid-3ef6ksr2><span data-astro-cid-3ef6ksr2>DEV</span></a> <a rel="me" href="https://github.com/scottnath" data-astro-cid-3ef6ksr2><img src="/_astro/github-inverse.5c5sSg3g.svg" alt="GitHub logo" data-astro-cid-3ef6ksr2><span data-astro-cid-3ef6ksr2>GitHub</span></a> <a rel="me" href="https://www.linkedin.com/in/scottnath" data-astro-cid-3ef6ksr2><img src="/_astro/linkedin.C92OM-O6.svg" alt="LinkedIn logo" data-astro-cid-3ef6ksr2><span data-astro-cid-3ef6ksr2>LinkedIn</span></a> <a rel="me" href="https://mastodon.social/@scottnath" data-astro-cid-3ef6ksr2><img src="/_astro/Mastodon.QaBq5b1c.svg" alt="Mastodon logo" data-astro-cid-3ef6ksr2><span data-astro-cid-3ef6ksr2>Mastodon</span></a> </address> </div> </header>  <main data-astro-transition-scope="astro-x5ucuxqb-1">  <article class="blog-post"> <img width="100%" height="auto" src="/js-framework-share-tests.png" alt=""> <h1 class="title">Sharing UI Tests Between Javascript Frameworks</h1> <time datetime="2023-06-27T00:00:00.000Z"> Jun 27, 2023 </time>  <hr>  <p>How to share testing-library UI tests between Javascript frameworks with the same or similar components and use them in Storybook and unit testing.</p>
<h2 id="tldr">tl;dr</h2>
<p>Tests can be shared between Javascript components which have a similar HTML structure and/or a similar UX. The same shared tests can be used in both Storybook’s <code>play</code> tests (Interaction testing) and Vitest unit tests.</p>
<ul>
<li><a href="https://github.com/storydocker/storydocker-examples/tree/main/experimental/astro-framework-multiple">working example on github</a></li>
<li><a href="https://storydocker.github.io/storydocker-examples/astro-framework-multiple/?path=/story/astro--astro">live Storybook with working play tests</a></li>
</ul>
<details>
<summary>Prerequisite knowledge</summary>
<ul>
<li><a href="https://storybook.js.org/docs/react/writing-tests/interaction-testing">Storybook interactive tests</a></li>
<li><a href="https://testing-library.com/">Testing Library</a></li>
</ul>
</details>
<h2 id="why-share-tests-between-javascript-frameworks">Why share tests between Javascript Frameworks?</h2>
<ul>
<li>You have one or more applications which share UX, but which are built with different JS Frameworks</li>
<li>When converting an application from one JS Framework to another</li>
<li>Your company maintains a design system with multiple component libraries built with different JS Frameworks, but the same UX</li>
</ul>
<h2 id="shared-tests-and-how-to-use-them">Shared tests and how to use them</h2>
<p>Staying D.R.Y. so… dig through <a href="/blahg/shared-storybook-tests/">part 1 - “What are shared tests”</a>, <a href="/blahg/sharing-tests-between-components/">part 2 - “Sharing tests between components”</a>, and <a href="/blahg/sharing-tests-between-vitest-and-storybook/">part 3 - “Sharing tests between Vitest and Storybook”</a> to get the low-down on shared tests.</p>
<h2 id="why-does-this-work-are-you-a-wizard">Why does this work? Are you a wizard?</h2>
<p>As I’ve been writing this series, I realized it’s an ode to the magic of <a href="https://testing-library.com/">Testing Library</a>, which is built for testing UIs as a user would experience an app. This principle means <code>Testing Library</code> is not introduced to your UI until after it has already rendered…which means <code>Testing Library</code> is navigating a DOM just as a user would…and users do not know or care what framework you used to build your UI, just that it works as expected.</p>
<p><code>Testing Library</code> is the real MVP here.</p>
<h2 id="what-are-we-testing-this-time">What are we testing this time?</h2>
<p>This article shows a set of shared-tests for testing a Counter component rewritten across multiple Javascript frameworks. We’ll be using the components found in the <a href="https://astro.build/">Astro Web Framework</a>’s example: <a href="https://github.com/withastro/astro/tree/latest/examples/framework-multiple?on=github"><code>Kitchen Sink (Multiple Frameworks)</code></a>. These are written in Preact, React, Svelte, SolidJS, and Vue. This Astro microfrontend example is fantastic in that it demonstrates how the Astro Web Framework can have multiple Javascript frameworks running on the same page at the same time.</p>
<p>Fun fact! This is the codebase I used to demonstrate Storybook presenting multiple frameworks in the <a href="/blahg/multi-framework-composition-storybook-local/">DevOps for Multi-Framework Composition Storybooks series</a>.</p>
<h3 id="what-is-the-counter-component">What is the Counter component?</h3>
<p>The Counter component is a simple component which displays a number and has two buttons: one to increment the number and one to decrement the number. <strong>Each framework version has the exact same UX and HTML structure</strong>, with slight variations due to the syntax of the framework.</p>
<h4 id="html-for-preactcountertsx">HTML for PreactCounter.tsx:</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"counter"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">{subtract}</span><span style="color:#E1E4E8">>-&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">>{count}&#x3C;/</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">{add}</span><span style="color:#E1E4E8">>+&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span></code></pre>
<h4 id="html-for-reactcountertsx">HTML for ReactCounter.tsx:</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> className</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"counter"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">{subtract}</span><span style="color:#E1E4E8">>-&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">>{count}&#x3C;/</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> onClick</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">{add}</span><span style="color:#E1E4E8">>+&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span></code></pre>
<h4 id="html-for-sveltecountersvelte">HTML for SvelteCounter.svelte:</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"counter"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> on:click</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">{subtract}</span><span style="color:#E1E4E8">>-&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">>{count}&#x3C;/</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> on:click</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">{add}</span><span style="color:#E1E4E8">>+&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span></code></pre>
<h4 id="html-for-vuecountervue">HTML for VueCounter.vue:</h4>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"counter"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> @click</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"subtract()"</span><span style="color:#E1E4E8">>-&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">>{{ count }}&#x3C;/</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#B392F0"> @click</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"add()"</span><span style="color:#E1E4E8">>+&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span></code></pre>
<h4 id="rendered-html-for-all-counter-components-is-the-same">Rendered HTML for all Counter components is the same</h4>
<p><em>All</em> components output the same HTML, which is the voodoo which makes this possible. Same HTML? Same tests.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">&#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"counter"</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">>-&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">>0&#x3C;/</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">  &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">>+&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span></span>
<span class="line"><span style="color:#E1E4E8">&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span></span></code></pre>
<h2 id="the-shared-tests">The shared tests</h2>
<h3 id="1-getting-the-elements">1. Getting the elements</h3>
<p>The first step? Query the DOM for the elements we want to test.</p>
<p>We need:</p>
<ul>
<li>the <code>+</code> (<code>plus</code>) button</li>
<li>the <code>-</code> (<code>minus</code>) button</li>
<li>the <code>pre</code> element which contains the count</li>
<li>the container, which is a <code>div</code> with a class of <code>counter</code></li>
</ul>
<p>Using <code>Testing Library</code>’s queries, we’ll create an object by parsing the rendered HTML. In this method, <code>canvasElement</code> is the live DOM rendered by the framework.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { within } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '@storybook/testing-library'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * Extract elements from an HTMLElement</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#B392F0"> getElements</span><span style="color:#F97583"> =</span><span style="color:#F97583"> async</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">canvasElement</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // `within` adds the testing-library query methods</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> screen</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> within</span><span style="color:#E1E4E8">(canvasElement);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> { </span></span>
<span class="line"><span style="color:#E1E4E8">    screen,</span></span>
<span class="line"><span style="color:#E1E4E8">    canvasElement,</span></span>
<span class="line"><span style="color:#6A737D">    // `querySelector` used here to find the generic `div` container</span></span>
<span class="line"><span style="color:#E1E4E8">    container: </span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> canvasElement.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'.counter'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#6A737D">    // `queryByRole` finds each button, using `name` to search the text</span></span>
<span class="line"><span style="color:#E1E4E8">    minus: </span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> screen.</span><span style="color:#B392F0">queryByRole</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'button'</span><span style="color:#E1E4E8">, { name:</span><span style="color:#9ECBFF"> /</span><span style="color:#DBEDFF">-</span><span style="color:#9ECBFF">/</span><span style="color:#F97583">i</span><span style="color:#E1E4E8"> }),</span></span>
<span class="line"><span style="color:#6A737D">    // using `queryBy` instead of `getBy` to avoid errors in `getElements`</span></span>
<span class="line"><span style="color:#E1E4E8">    plus: </span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> screen.</span><span style="color:#B392F0">queryByRole</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'button'</span><span style="color:#E1E4E8">, { name:</span><span style="color:#9ECBFF"> /</span><span style="color:#85E89D;font-weight:bold">\+</span><span style="color:#9ECBFF">/</span><span style="color:#F97583">i</span><span style="color:#E1E4E8"> }),</span></span>
<span class="line"><span style="color:#6A737D">    // `querySelector` again as `pre` has no role and contains variable content</span></span>
<span class="line"><span style="color:#E1E4E8">    count: </span><span style="color:#F97583">await</span><span style="color:#E1E4E8"> canvasElement.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pre'</span><span style="color:#E1E4E8">),</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>This returns an object with our elements:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#B392F0">  screen</span><span style="color:#E1E4E8">: {object </span><span style="color:#F97583">with</span><span style="color:#E1E4E8"> testing</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">library query methods},</span></span>
<span class="line"><span style="color:#B392F0">  canvasElement</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">&#x3C;</span><span style="color:#E1E4E8">the</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">initial</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">html</span><span style="color:#F97583">-</span><span style="color:#E1E4E8">element,unchanged</span><span style="color:#F97583">></span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#B392F0">  container</span><span style="color:#E1E4E8">: &#x3C;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> class</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"counter"</span><span style="color:#E1E4E8">>...&#x3C;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">></span><span style="color:#F97583">/</span><span style="color:#E1E4E8">{and query methods},</span></span>
<span class="line"><span style="color:#B392F0">  minus</span><span style="color:#E1E4E8">: &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">>-&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span><span style="color:#F97583">/</span><span style="color:#E1E4E8">{and query methods},</span></span>
<span class="line"><span style="color:#B392F0">  plus</span><span style="color:#E1E4E8">: &#x3C;</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">>+&#x3C;/</span><span style="color:#85E89D">button</span><span style="color:#E1E4E8">></span><span style="color:#F97583">/</span><span style="color:#E1E4E8">{and query methods},</span></span>
<span class="line"><span style="color:#B392F0">  count</span><span style="color:#E1E4E8">: &#x3C;</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">>0&#x3C;/</span><span style="color:#85E89D">pre</span><span style="color:#E1E4E8">></span><span style="color:#F97583">/</span><span style="color:#E1E4E8">{and query methods},</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="2-testing-the-initial-rendered-elements">2. Testing the initial rendered elements</h3>
<p>The Counter is a simple component that has no props, so this method just ensures the elements are present and the counter starts at <code>0</code>. <code>ensureElements</code> should be called before interaction tests to ensure the initial state of the component is what is tested.</p>
<p>The <code>elements</code> arg is the object returned from <code>getElements</code>.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * Ensure elements are present and have the correct attributes/content</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#B392F0"> ensureElements</span><span style="color:#F97583"> =</span><span style="color:#F97583"> async</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">elements</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">minus</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">plus</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">count</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elements;</span></span>
<span class="line"><span style="color:#6A737D">  // `.toBeTruthy` ensures the element exists</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(minus).</span><span style="color:#B392F0">toBeTruthy</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(plus).</span><span style="color:#B392F0">toBeTruthy</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(count).</span><span style="color:#B392F0">toBeTruthy</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">  // ensures the count starts at zero</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(count).</span><span style="color:#B392F0">toHaveTextContent</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'0'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="3-testing-keyboard-navigation">3. Testing keyboard navigation</h3>
<p>For keyboard-only users, we’ll need to ensure the buttons are focusable and in the expected order. We test navigation separate from interactions to keep the testing methods focused on one type of user experience at a time.</p>
<p>The component only has two focus-able elements - which are the buttons.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * Test keyboard interaction</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#B392F0"> keyboardNavigation</span><span style="color:#F97583"> =</span><span style="color:#F97583"> async</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">elements</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">minus</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">plus</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">container</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elements;</span></span>
<span class="line"><span style="color:#6A737D">  // tab within the container</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">tab</span><span style="color:#E1E4E8">({ focusTrap: container });</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(minus).</span><span style="color:#B392F0">toHaveFocus</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">  // `pre` is the next element, but it's not focusable</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">tab</span><span style="color:#E1E4E8">({ focusTrap: container });</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(plus).</span><span style="color:#B392F0">toHaveFocus</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="4-testing-keyboard-interactions">4. Testing keyboard interactions</h3>
<p>For testing the interaction of the buttons, we’ll be adding or subtracting to the number in <code>pre</code>. We cannot ensure the order the testing methods will be used, which means <code>elements.count</code> might not be <code>0</code>. This test method will start by getting whatever number is in <code>elements.count</code> and use that number to test the expected addition or subtraction result.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * Test keyboard interactions</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#B392F0"> keyboardInteraction</span><span style="color:#F97583"> =</span><span style="color:#F97583"> async</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">elements</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">minus</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">plus</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">count</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">container</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elements;</span></span>
<span class="line"><span style="color:#6A737D">  // could be any number</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> initCount</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> parseInt</span><span style="color:#E1E4E8">(count.textContent);</span></span>
<span class="line"><span style="color:#6A737D">  // navigation unimportant here, so we'll just focus on the button</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> plus.</span><span style="color:#B392F0">focus</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">  // with the `plus` button in focus, hitting `enter` should increment</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">keyboard</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'{enter}'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">keyboard</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'{enter}'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> minus.</span><span style="color:#B392F0">focus</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">keyboard</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'{enter}'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">keyboard</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'{enter}'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">keyboard</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'{enter}'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">  // reset user focus to nothing</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> minus.</span><span style="color:#B392F0">blur</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="5-testing-mouse-interactions">5. Testing mouse interactions</h3>
<p>Same as keyboard interactions, but with mouse clicks instead of keyboard events.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">/**</span></span>
<span class="line"><span style="color:#6A737D"> * Test mouse interaction</span></span>
<span class="line"><span style="color:#6A737D"> */</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#B392F0"> mouseInteraction</span><span style="color:#F97583"> =</span><span style="color:#F97583"> async</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">elements</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#E1E4E8"> { </span><span style="color:#79B8FF">minus</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">plus</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">count</span><span style="color:#E1E4E8"> } </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> elements;</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> initCount</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> parseInt</span><span style="color:#E1E4E8">(count.textContent);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">click</span><span style="color:#E1E4E8">(plus);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">click</span><span style="color:#E1E4E8">(plus);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 2</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">click</span><span style="color:#E1E4E8">(minus);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount </span><span style="color:#F97583">+</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">click</span><span style="color:#E1E4E8">(minus);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> userEvent.</span><span style="color:#B392F0">click</span><span style="color:#E1E4E8">(minus);</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#B392F0"> expect</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">parseInt</span><span style="color:#E1E4E8">(count.textContent)).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(initCount </span><span style="color:#F97583">-</span><span style="color:#79B8FF"> 1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">  // reset user focus</span></span>
<span class="line"><span style="color:#F97583">  await</span><span style="color:#E1E4E8"> minus.</span><span style="color:#B392F0">blur</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="using-the-shared-tests-in-storybook">Using the shared tests in Storybook</h2>
<p>Now that we have our shared tests, we can use them in Storybook. (see <a href="/blahg/shared-storybook-tests/">part 1</a>). Below is the React story file, see <a href="https://github.com/storydocker/storydocker-examples/tree/main/experimental/astro-framework-multiple/.framework-storybooks/stories">the full set of framework-specific stories here</a>. The test methods are broken out into <code>step</code> functions for legibility in the Storybook UI, but they are not required.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">// ReactCounter.stories.js</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { ReactCounter } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '../../src/components/ReactCounter'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { getElements, ensureElements, mouseInteraction, keyboardNavigation, keyboardInteraction } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '../../src/components/tests/counter.shared-spec'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> default</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  title: </span><span style="color:#9ECBFF">'React'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  component: ReactCounter,</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> React</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  play</span><span style="color:#E1E4E8">: </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> ({ </span><span style="color:#FFAB70">args</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">canvasElement</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">step</span><span style="color:#E1E4E8"> }) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> elements</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> getElements</span><span style="color:#E1E4E8">(canvasElement);</span></span>
<span class="line"><span style="color:#B392F0">    step</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'react tests'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#B392F0"> step</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'ensure elements'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        await</span><span style="color:#B392F0"> ensureElements</span><span style="color:#E1E4E8">(elements);</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#B392F0"> step</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'mouse interaction'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        await</span><span style="color:#B392F0"> mouseInteraction</span><span style="color:#E1E4E8">(elements);</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#B392F0"> step</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'keyboard navigation'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        await</span><span style="color:#B392F0"> keyboardNavigation</span><span style="color:#E1E4E8">(elements);</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#B392F0"> step</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'keyboard interaction'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        await</span><span style="color:#B392F0"> keyboardInteraction</span><span style="color:#E1E4E8">(elements);</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<h2 id="using-the-shared-tests-in-vitest-unit-tests">Using the shared tests in Vitest unit tests</h2>
<p>They also drop-in to our unit tests. (see <a href="/blahg/sharing-tests-between-vitest-and-storybook/">part 3</a>). Below is the React unit test file, see <a href="https://github.com/storydocker/storydocker-examples/tree/main/experimental/astro-framework-multiple/src/components/tests">the full set of framework-specific unit tests here</a>. The magic here is in the <code>render</code> function. Each framework has a different one, but once Vitest renders it, the resulting output of all frameworks is understood by the shared tests.</p>
<p><em>note:</em> The separate <code>it</code> functions are required for now for React, which was having some issues isolating the user interactions when they are all ran together. The <code>it</code> functions are not required for all frameworks, but since they give legibility anyway, we’ll keep them.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Vue.spec.tsx</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { render } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '@testing-library/vue'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { describe, it, assert, expect } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'vitest'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> VueCounter </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '@/components/VueCounter.vue'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { getElements, ensureElements, mouseInteraction, keyboardNavigation, keyboardInteraction } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '@/components/tests/counter.shared-spec'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Vue'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Counter'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'ensure elements'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> rendered</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> render</span><span style="color:#E1E4E8">(VueCounter);</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> elements</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> getElements</span><span style="color:#E1E4E8">(rendered.container);</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#B392F0"> ensureElements</span><span style="color:#E1E4E8">(elements);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'mouse interaction'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> rendered</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> render</span><span style="color:#E1E4E8">(VueCounter);</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> elements</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> getElements</span><span style="color:#E1E4E8">(rendered.container);</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#B392F0"> mouseInteraction</span><span style="color:#E1E4E8">(elements);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'keyboard navigation'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> rendered</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> render</span><span style="color:#E1E4E8">(VueCounter);</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> elements</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> getElements</span><span style="color:#E1E4E8">(rendered.container);</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#B392F0"> keyboardNavigation</span><span style="color:#E1E4E8">(elements);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'keyboard interaction'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">async</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> rendered</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> render</span><span style="color:#E1E4E8">(VueCounter);</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> elements</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> getElements</span><span style="color:#E1E4E8">(rendered.container);</span></span>
<span class="line"><span style="color:#F97583">      await</span><span style="color:#B392F0"> keyboardInteraction</span><span style="color:#E1E4E8">(elements);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">})</span></span></code></pre>
<h2 id="wrapping-up">Wrapping up</h2>
<p>Writing sharable user-experience-based tests for your UI is really about planning for the future.</p>
<p>The NewHotness™ UI framework is being built right now and in two years that React component you put your soul into is going to be deleted in lieu of the shiny thing. That doesn’t mean your UX needs to change … or your Design … or your tests. Just do the facelift next time.</p>
<p><em>Efficiency in all things, and productivity will follow.</em></p>  </article>  </main> <footer data-astro-cid-sz7xmlte> <hr data-astro-cid-sz7xmlte>
&copy; 2024&nbsp;Scott Nath All rights reserved.
</footer>  </body></html>