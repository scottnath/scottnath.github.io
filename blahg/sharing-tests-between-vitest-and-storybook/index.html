<!DOCTYPE html><html lang="en-US"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon-mind-blown.ico" id="favicon"><meta http-equiv="content-language" content="en-us"><link rel="sitemap" href="/sitemap.xml"><meta name="generator" content="Macromedia Dreamweaver 6.0"><link rel="preload" as="image" href="/blahg-assets/vitest-shared-tests-basic.avif"><link rel="alternate" type="application/rss+xml" title="Blah blah blahg by Scott Nath, Articles and rambling-on by Scott Nath" href="https://scottnath.com/rss.xml"><link rel="webmention" href="https://webmention.io/scottnath.com/webmention"><link rel="pingback" href="https://webmention.io/scottnath.com/xmlrpc"><!-- Canonical URL --><link rel="canonical" href="https://scottnath.com/blahg/sharing-tests-between-vitest-and-storybook/"><!-- Primary Meta Tags --><title>Sharing Interaction Tests Between Vitest and Storybook</title><meta name="title" content="Sharing Interaction Tests Between Vitest and Storybook"><meta name="description" content="How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite's native test runner."><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://scottnath.com/blahg/sharing-tests-between-vitest-and-storybook/"><meta property="og:title" content="Sharing Interaction Tests Between Vitest and Storybook"><meta property="og:description" content="How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite's native test runner."><meta property="og:image" content="https://scottnath.com/blahg-assets/vitest-shared-tests-basic.avif"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://scottnath.com/blahg/sharing-tests-between-vitest-and-storybook/"><meta property="twitter:title" content="Sharing Interaction Tests Between Vitest and Storybook"><meta property="twitter:description" content="How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite's native test runner."><meta property="twitter:image" content="https://scottnath.com/blahg-assets/vitest-shared-tests-basic.avif"><script defer data-domain="scottnath.com" src="https://plausible.io/js/script.js" type="text/partytown"></script><script defer data-domain="scottnath.com" src="https://plausible.io/js/script.outbound-links.js" type="text/partytown"></script><link rel="stylesheet" href="/_astro/_slug_.BwqpPIKv.css"><script type="module">const e=()=>{const i=document.querySelector("#favicon");if(document.hidden){const n=i?.href;document.initialFavicon=n,i.href="/favicon-clown.ico"}else document.initialFavicon!==""&&(i.href=document.initialFavicon)};document.addEventListener("visibilitychange",e,!0);document.initialFavicon=document.querySelector("#favicon").href;
</script>
<script>/** @license Copyright 2020 Google LLC (BSD-3-Clause) */
/** Bundled JS generated from "@astrojs/lit/client-shim.js" */
var N = Object.defineProperty;
var i = (t, n) => () => (t && (n = t((t = 0))), n);
var b = (t, n) => {
	for (var a in n) N(t, a, { get: n[a], enumerable: !0 });
};
function s() {
	if (d === void 0) {
		let t = document.createElement('div');
		(t.innerHTML = '<div><template shadowroot="open" shadowrootmode="open"></template></div>'),
			(d = !!t.firstElementChild.shadowRoot);
	}
	return d;
}
var d,
	m = i(() => {});
var p,
	c,
	f,
	u = i(() => {
		(p = (t) => t.parentElement === null),
			(c = (t) => t.tagName === 'TEMPLATE'),
			(f = (t) => t.nodeType === Node.ELEMENT_NODE);
	});
var h,
	E = i(() => {
		m();
		u();
		h = (t) => {
			var n;
			if (s()) return;
			let a = [],
				e = t.firstElementChild;
			for (; e !== t && e !== null; )
				if (c(e)) a.push(e), (e = e.content);
				else if (e.firstElementChild !== null) e = e.firstElementChild;
				else if (f(e) && e.nextElementSibling !== null) e = e.nextElementSibling;
				else {
					let o;
					for (; e !== t && e !== null; )
						if (p(e)) {
							o = a.pop();
							let r = o.parentElement,
								l = o.getAttribute('shadowroot');
							if (((e = o), l === 'open' || l === 'closed')) {
								let y = o.hasAttribute('shadowrootdelegatesfocus');
								try {
									r.attachShadow({ mode: l, delegatesFocus: y }).append(o.content);
								} catch {}
							} else o = void 0;
						} else {
							let r = e.nextElementSibling;
							if (r != null) {
								(e = r), o !== void 0 && o.parentElement.removeChild(o);
								break;
							}
							let l =
								(n = e.parentElement) === null || n === void 0 ? void 0 : n.nextElementSibling;
							if (l != null) {
								(e = l), o !== void 0 && o.parentElement.removeChild(o);
								break;
							}
							(e = e.parentElement), o !== void 0 && (o.parentElement.removeChild(o), (o = void 0));
						}
				}
		};
	});
var w = i(() => {
	E();
});
var v = {};
b(v, { hasNativeDeclarativeShadowRoots: () => s, hydrateShadowRoots: () => h });
var S = i(() => {
	m();
	w();
});
async function g() {
	let { hydrateShadowRoots: t } = await Promise.resolve().then(() => (S(), v));
	window.addEventListener('DOMContentLoaded', () => t(document.body), { once: true });
}
var x = new DOMParser()
	.parseFromString(
		'<p><template shadowroot="open" shadowrootmode="open"></template></p>',
		'text/html',
		{
			includeShadowRoots: !0,
		}
	)
	.querySelector('p');
(!x || !x.shadowRoot) && g();
</script>
<script>!(function(w,p,f,c){if(!window.crossOriginIsolated && !navigator.serviceWorker) return;c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.8.2 - MIT builder.io */
!function(t,e,n,i,o,r,a,s,d,c,l,p){function u(){p||(p=1,"/"==(a=(r.lib||"/~partytown/")+(r.debug?"debug/":""))[0]&&(d=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(s=setTimeout(f,1e4),e.addEventListener("pt0",w),o?h(1):n.serviceWorker?n.serviceWorker.register(a+(r.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):f())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.style.display="block",c.style.width="0",c.style.height="0",c.style.border="0",c.style.visibility="hidden",c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.8.2":"sandbox-sw.html?"+Date.now()),e.querySelector(r.sandboxParent||"body").appendChild(c)}function f(n,o){for(w(),i==t&&(r.forward||[]).map((function(e){delete t[e.split(".")[0]]})),n=0;n<d.length;n++)(o=e.createElement("script")).innerHTML=d[n].innerHTML,o.nonce=r.nonce,e.head.appendChild(o);c&&c.parentNode.removeChild(c)}function w(){clearTimeout(s)}r=t.partytown||{},i==t&&(r.forward||[]).map((function(e){l=t,e.split(".").map((function(e,n,i){l=l[i[n]]=n+1<i.length?"push"==i[n+1]?[]:l[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);;((d,s)=>(s=d.currentScript,d.addEventListener('astro:before-swap',()=>s.remove(),{once:true})))(document);</script></head> <body> <a href="#main" id="skip-to-main">Skip to main content</a> <header data-astro-cid-3ef6ksr2> <h2 data-astro-cid-3ef6ksr2> <span class="name" data-astro-cid-3ef6ksr2>Scott Nath</span> <span class="title" data-astro-cid-3ef6ksr2>Frontend Architect</span> </h2> <nav data-astro-cid-2hp2wczs> <dope-stripes data-astro-cid-2hp2wczs="true"><template shadowroot="open" shadowrootmode="open"><style>:host{display:block;position:relative;--angle-x-start: 35%;--angle-width: 5%;--angle-y-end: 40px;--stripe-height: 16px;--stripe-color: #ffe27a;width:100%;min-height:var(--stripe-height)}::slotted(dope-stripe),dope-stripe{--no-top-margin: -1}dope-stripe:first-child{--no-top-margin: 0}.stripes:not(:has(dope-stripe)) ::slotted(dope-stripe:first-child){--no-top-margin: 0}</style><!--lit-part grV36YUwDSo=--><div class="stripes" part="stripes" exportparts="stripe">
      <!--lit-part--><!--/lit-part-->
      <slot></slot>
  </div><!--/lit-part--></template> <dope-stripe defer-hydration data-astro-cid-2hp2wczs="true"><template shadowroot="open" shadowrootmode="open"><style>
    :host {
      --angle-x-start: 35%;
      --angle-width: 5%;
      --angle-y-end: 40px;
      --stripe-height: 16px;
      --stripe-color:#ffe27a;
      --top-margin: var(--no-top-margin, 0);

      --angle-x-end: calc(var(--angle-x-start) + var(--angle-width));
      --stripe-box-height: calc(var(--angle-y-end) + var(--stripe-height));
      --angle-y-right-bottom: calc(var(--angle-y-end) + var(--stripe-height));

      --polygon-path: 
        0 0, 
        var(--angle-x-start) 0, 
        var(--angle-x-end) var(--angle-y-end), 
        100% var(--angle-y-end), 
        100% var(--stripe-box-height), 
        var(--angle-x-end) var(--stripe-box-height), 
        var(--angle-x-start) var(--stripe-height), 
        0 var(--stripe-height);

      width: 100%;
      position: relative;
      display: block;
      margin-top: calc((var(--angle-y-end) + 1px) * var(--top-margin));
      clip-path: polygon(var(--polygon-path));
    }

    [part=stripe] {
      background-color: var(--stripe-color);
      width: 100%;
      height: var(--stripe-box-height);
      position: relative;
    }
  </style><!--lit-part 2hRJq3MaOiM=--><!--lit-node 0--><div part="stripe" style="--stripe-color: #ffd273"><slot></slot></div><!--/lit-part--></template> <a href="/" data-astro-cid-2hp2wczs data-astro-cid-eimmu3lg> <span data-astro-cid-2hp2wczs>home</span> </a>  </dope-stripe> <dope-stripe defer-hydration data-astro-cid-2hp2wczs="true"><template shadowroot="open" shadowrootmode="open"><style>
    :host {
      --angle-x-start: 35%;
      --angle-width: 5%;
      --angle-y-end: 40px;
      --stripe-height: 16px;
      --stripe-color:#ffe27a;
      --top-margin: var(--no-top-margin, 0);

      --angle-x-end: calc(var(--angle-x-start) + var(--angle-width));
      --stripe-box-height: calc(var(--angle-y-end) + var(--stripe-height));
      --angle-y-right-bottom: calc(var(--angle-y-end) + var(--stripe-height));

      --polygon-path: 
        0 0, 
        var(--angle-x-start) 0, 
        var(--angle-x-end) var(--angle-y-end), 
        100% var(--angle-y-end), 
        100% var(--stripe-box-height), 
        var(--angle-x-end) var(--stripe-box-height), 
        var(--angle-x-start) var(--stripe-height), 
        0 var(--stripe-height);

      width: 100%;
      position: relative;
      display: block;
      margin-top: calc((var(--angle-y-end) + 1px) * var(--top-margin));
      clip-path: polygon(var(--polygon-path));
    }

    [part=stripe] {
      background-color: var(--stripe-color);
      width: 100%;
      height: var(--stripe-box-height);
      position: relative;
    }
  </style><!--lit-part 2hRJq3MaOiM=--><!--lit-node 0--><div part="stripe" style="--stripe-color: #ffbf57"><slot></slot></div><!--/lit-part--></template> <a href="/whoami" data-astro-cid-2hp2wczs data-astro-cid-eimmu3lg> <span data-astro-cid-2hp2wczs>whoami</span> </a>  </dope-stripe> <dope-stripe defer-hydration data-astro-cid-2hp2wczs="true"><template shadowroot="open" shadowrootmode="open"><style>
    :host {
      --angle-x-start: 35%;
      --angle-width: 5%;
      --angle-y-end: 40px;
      --stripe-height: 16px;
      --stripe-color:#ffe27a;
      --top-margin: var(--no-top-margin, 0);

      --angle-x-end: calc(var(--angle-x-start) + var(--angle-width));
      --stripe-box-height: calc(var(--angle-y-end) + var(--stripe-height));
      --angle-y-right-bottom: calc(var(--angle-y-end) + var(--stripe-height));

      --polygon-path: 
        0 0, 
        var(--angle-x-start) 0, 
        var(--angle-x-end) var(--angle-y-end), 
        100% var(--angle-y-end), 
        100% var(--stripe-box-height), 
        var(--angle-x-end) var(--stripe-box-height), 
        var(--angle-x-start) var(--stripe-height), 
        0 var(--stripe-height);

      width: 100%;
      position: relative;
      display: block;
      margin-top: calc((var(--angle-y-end) + 1px) * var(--top-margin));
      clip-path: polygon(var(--polygon-path));
    }

    [part=stripe] {
      background-color: var(--stripe-color);
      width: 100%;
      height: var(--stripe-box-height);
      position: relative;
    }
  </style><!--lit-part 2hRJq3MaOiM=--><!--lit-node 0--><div part="stripe" style="--stripe-color: #ffa43b"><slot></slot></div><!--/lit-part--></template> <a href="/blahg" class="active" data-astro-cid-2hp2wczs data-astro-cid-eimmu3lg> <span data-astro-cid-2hp2wczs>blahg</span> </a>  </dope-stripe> <dope-stripe defer-hydration data-astro-cid-2hp2wczs="true"><template shadowroot="open" shadowrootmode="open"><style>
    :host {
      --angle-x-start: 35%;
      --angle-width: 5%;
      --angle-y-end: 40px;
      --stripe-height: 16px;
      --stripe-color:#ffe27a;
      --top-margin: var(--no-top-margin, 0);

      --angle-x-end: calc(var(--angle-x-start) + var(--angle-width));
      --stripe-box-height: calc(var(--angle-y-end) + var(--stripe-height));
      --angle-y-right-bottom: calc(var(--angle-y-end) + var(--stripe-height));

      --polygon-path: 
        0 0, 
        var(--angle-x-start) 0, 
        var(--angle-x-end) var(--angle-y-end), 
        100% var(--angle-y-end), 
        100% var(--stripe-box-height), 
        var(--angle-x-end) var(--stripe-box-height), 
        var(--angle-x-start) var(--stripe-height), 
        0 var(--stripe-height);

      width: 100%;
      position: relative;
      display: block;
      margin-top: calc((var(--angle-y-end) + 1px) * var(--top-margin));
      clip-path: polygon(var(--polygon-path));
    }

    [part=stripe] {
      background-color: var(--stripe-color);
      width: 100%;
      height: var(--stripe-box-height);
      position: relative;
    }
  </style><!--lit-part 2hRJq3MaOiM=--><!--lit-node 0--><div part="stripe" style="--stripe-color: #ff8920"><slot></slot></div><!--/lit-part--></template> <a href="/resume" data-astro-cid-2hp2wczs data-astro-cid-eimmu3lg> <span data-astro-cid-2hp2wczs>resume</span> </a>  </dope-stripe> <dope-stripe defer-hydration data-astro-cid-2hp2wczs="true"><template shadowroot="open" shadowrootmode="open"><style>
    :host {
      --angle-x-start: 35%;
      --angle-width: 5%;
      --angle-y-end: 40px;
      --stripe-height: 16px;
      --stripe-color:#ffe27a;
      --top-margin: var(--no-top-margin, 0);

      --angle-x-end: calc(var(--angle-x-start) + var(--angle-width));
      --stripe-box-height: calc(var(--angle-y-end) + var(--stripe-height));
      --angle-y-right-bottom: calc(var(--angle-y-end) + var(--stripe-height));

      --polygon-path: 
        0 0, 
        var(--angle-x-start) 0, 
        var(--angle-x-end) var(--angle-y-end), 
        100% var(--angle-y-end), 
        100% var(--stripe-box-height), 
        var(--angle-x-end) var(--stripe-box-height), 
        var(--angle-x-start) var(--stripe-height), 
        0 var(--stripe-height);

      width: 100%;
      position: relative;
      display: block;
      margin-top: calc((var(--angle-y-end) + 1px) * var(--top-margin));
      clip-path: polygon(var(--polygon-path));
    }

    [part=stripe] {
      background-color: var(--stripe-color);
      width: 100%;
      height: var(--stripe-box-height);
      position: relative;
    }
  </style><!--lit-part 2hRJq3MaOiM=--><!--lit-node 0--><div part="stripe" style="--stripe-color: #ff6e05"><slot></slot></div><!--/lit-part--></template></dope-stripe> </dope-stripes> </nav>  <img src="/scott-nath-profile-photo.avif" alt="Scott Nath's picture" width="400" height="400" class="avatar" data-astro-cid-3ef6ksr2> <address class="socials" aria-label="Also find me on these sites" data-astro-cid-6jz5wqfy> <a rel="me" href="https://github.com/scottnath" aria-label="Scott Nath on GitHub" data-astro-cid-6jz5wqfy><img src="/_astro/github-inverse.5c5sSg3g.svg" alt="GitHub logo" aria-hidden="true" data-astro-cid-6jz5wqfy><span data-astro-cid-6jz5wqfy>GitHub</span></a><a rel="me" href="https://dev.to/scottnath" aria-label="Scott Nath's articles on dev.to" data-astro-cid-6jz5wqfy><img src="/_astro/dev.DPyAJ8Ri.svg" alt="dev.to logo" aria-hidden="true" data-astro-cid-6jz5wqfy><span data-astro-cid-6jz5wqfy>dev.to</span></a><a rel="me" href="https://linkedin.com/in/scottnath" aria-label="Connect with Scott Nath on LinkedIn" data-astro-cid-6jz5wqfy><img src="/_astro/linkedin.C92OM-O6.svg" alt="LinkedIn logo" aria-hidden="true" data-astro-cid-6jz5wqfy><span data-astro-cid-6jz5wqfy>LinkedIn</span></a><a rel="me" href="https://mastodon.social/@scottnath" aria-label="Read Scott Nath blah on Mastodon" data-astro-cid-6jz5wqfy><img src="/_astro/Mastodon.QaBq5b1c.svg" alt="Mastodon logo" aria-hidden="true" data-astro-cid-6jz5wqfy><span data-astro-cid-6jz5wqfy>Mastodon</span></a> </address>  </header>  <main id="main">  <article class="blog-post" itemscope itemtype="https://schema.org/TechArticle"> <header> <img width="100%" height="auto" src="/blahg-assets/vitest-shared-tests-basic.avif" alt="Header image for article 'Sharing Interaction Tests Between Vitest and Storybook'"> <h1 class="title" itemprop="name">Sharing Interaction Tests Between Vitest and Storybook</h1> <p itemprop="description">How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite&#39;s native test runner.</p> <dl class="article-dates"> <div> <dt>Published</dt> <dd><time datetime="2023-06-08T00:00:00.000Z" itemprop="datePublished"> Jun 8, 2023 </time></dd> </div>  </dl> </header> <hr> <div class="readable" itemprop="articleBody"> <p>How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite’s native test runner.</p>
<h2 id="tldr">tl;dr</h2>
<p>Tests can be shared between Vitest tests (<code>*.test.js</code>) and Storybook stories’ <code>play</code> tests by using shared test files (<code>*.shared-spec.js</code>).</p>
<p>Replace all assertions:</p>
<pre class="astro-code slack-dark" style="background-color:#222222;color:#E6E6E6; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA">describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'Meow component'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should meow'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">thing1</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">thing2</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">thing3</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">thing4</span><span style="color:#E6E6E6"> } </span><span style="color:#D4D4D4">=</span><span style="color:#DCDCAA"> render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Meow</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#DCDCAA">    expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">thing1</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toBe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'some assertion 1'</span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#DCDCAA">    expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">thing2</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toBe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'some assertion 2'</span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#DCDCAA">    expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">thing3</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toBe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'some assertion 3'</span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#DCDCAA">    expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">thing4</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toBe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'some assertion 4'</span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#E6E6E6">  })</span></span>
<span class="line"><span style="color:#E6E6E6">})</span></span>
<span class="line"></span></code></pre>
<p>With shared tests:</p>
<pre class="astro-code slack-dark" style="background-color:#222222;color:#E6E6E6; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA">describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'Meow component'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should meow'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">    sharedTests</span><span style="color:#E6E6E6">(</span><span style="color:#DCDCAA">render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Meow</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">), </span><span style="color:#9CDCFE">Meow</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">props</span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#E6E6E6">  })</span></span>
<span class="line"><span style="color:#E6E6E6">})</span></span>
<span class="line"></span></code></pre>
<details>
<summary>Series: Sharing tests across UI components</summary>
<ul>
<li><a href="part1">PART 1: Reusable Storybook Interaction Tests</a></li>
<li><a href="part2">PART 2: Sharing Interaction Tests Between Components</a></li>
</ul>
</details>
<details>
<summary>Prerequisite knowledge</summary>
<ul>
<li><a href="https://storybook.js.org/docs/react/writing-tests/interaction-testing">Storybook interactive tests</a></li>
<li><a href="https://testing-library.com">Testing Library</a></li>
<li><a href="https://vitest.dev/">Vitest</a></li>
</ul>
</details>
<h2 id="why-share-tests-between-storybook-and-unit-tests">Why share tests between Storybook and Unit tests?</h2>
<p>Time and money!</p>
<p>…and coverage reporting requirements…and trust issues…</p>
<ul>
<li>If your Continuous Integration system does not allow the installation of Playwright or running a browser, <code>test-storybook</code> cannot be used in CI to test your components</li>
<li>If your coverage tool does not support Storybook’s <code>play</code> or <code>smoke</code> tests, but you’re already writing Interactive tests in Storybook</li>
<li>If you (or your Dev team) prefer not to rely solely on Storybook as your only test suite</li>
<li>If you want <strong>a single source of truth for your component’s tests</strong></li>
</ul>
<h2 id="shared-tests-and-how-to-use-them">Shared tests and how to use them</h2>
<p>Staying D.R.Y. so… see <a href="/blahg/shared-storybook-tests/">part 1</a> and <a href="/blahg/sharing-tests-between-components/">part 2</a> of the shared tests series for details.</p>
<h2 id="basic-example-of-shared-spec-tests-being-used-in-vitest">Basic example of shared-spec tests being used in Vitest</h2>
<p>Take a basic Vitest for a button:</p>
<pre class="astro-code slack-dark" style="background-color:#222222;color:#E6E6E6; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A9955">// button.test.js</span></span>
<span class="line"><span style="color:#C586C0">import</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">render</span><span style="color:#E6E6E6"> } </span><span style="color:#C586C0">from</span><span style="color:#CE9178"> '@testing-library/react'</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#C586C0">import</span><span style="color:#9CDCFE"> userEvent</span><span style="color:#C586C0"> from</span><span style="color:#CE9178"> '@testing-library/user-event'</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#C586C0">import</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">vi</span><span style="color:#E6E6E6"> } </span><span style="color:#C586C0">from</span><span style="color:#CE9178"> 'vitest'</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#DCDCAA">describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'MeowButton'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">  const</span><span style="color:#9CDCFE"> props</span><span style="color:#D4D4D4"> =</span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#9CDCFE">    label:</span><span style="color:#CE9178"> 'meow'</span></span>
<span class="line"><span style="color:#9CDCFE">    onClick</span><span style="color:#E6E6E6">: </span><span style="color:#9CDCFE">vi</span><span style="color:#E6E6E6">.</span><span style="color:#DCDCAA">fn</span><span style="color:#E6E6E6">(),</span></span>
<span class="line"><span style="color:#E6E6E6">  };</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should have properly configured attributes'</span><span style="color:#E6E6E6">, </span><span style="color:#569CD6">async</span><span style="color:#E6E6E6"> () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">queryByRole</span><span style="color:#E6E6E6"> } </span><span style="color:#D4D4D4">=</span><span style="color:#DCDCAA"> render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Button</span><span style="color:#569CD6"> {</span><span style="color:#D4D4D4">...</span><span style="color:#9CDCFE">props</span><span style="color:#569CD6">}</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> button</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> queryByRole</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'button'</span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toBeTruthy</span><span style="color:#E6E6E6">();</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toHaveTextContent</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">props</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">label</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should respond to mouse interaction'</span><span style="color:#E6E6E6">, </span><span style="color:#569CD6">async</span><span style="color:#E6E6E6"> () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">queryByRole</span><span style="color:#E6E6E6"> } </span><span style="color:#D4D4D4">=</span><span style="color:#DCDCAA"> render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Button</span><span style="color:#569CD6"> {</span><span style="color:#D4D4D4">...</span><span style="color:#9CDCFE">props</span><span style="color:#569CD6">}</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> button</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> queryByRole</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'button'</span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#9CDCFE"> userEvent</span><span style="color:#E6E6E6">.</span><span style="color:#DCDCAA">click</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">onClick</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toHaveBeenCalled</span><span style="color:#E6E6E6">();</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">onClick</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toHaveBeenCalledTimes</span><span style="color:#E6E6E6">(</span><span style="color:#B5CEA8">1</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#9CDCFE"> args</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">onClick</span><span style="color:#E6E6E6">.</span><span style="color:#DCDCAA">mockClear</span><span style="color:#E6E6E6">();</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#E6E6E6">});</span></span>
<span class="line"></span></code></pre>
<p>If you have shared-test methods like this:</p>
<pre class="astro-code slack-dark" style="background-color:#222222;color:#E6E6E6; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A9955">// button.shared-spec.js</span></span>
<span class="line"><span style="color:#C586C0">import</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">within</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">userEvent</span><span style="color:#E6E6E6"> } </span><span style="color:#C586C0">from</span><span style="color:#CE9178"> '@storybook/testing-library'</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#C586C0">export</span><span style="color:#569CD6"> const</span><span style="color:#DCDCAA"> getElements</span><span style="color:#D4D4D4"> =</span><span style="color:#569CD6"> async</span><span style="color:#E6E6E6"> (</span><span style="color:#9CDCFE">canvasElement</span><span style="color:#E6E6E6">) </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">  const</span><span style="color:#9CDCFE"> button</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> within</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">canvasElement</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">findByRole</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'button'</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">  return</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6"> };</span></span>
<span class="line"><span style="color:#E6E6E6">};</span></span>
<span class="line"><span style="color:#C586C0">export</span><span style="color:#569CD6"> const</span><span style="color:#DCDCAA"> ensureElements</span><span style="color:#D4D4D4"> =</span><span style="color:#569CD6"> async</span><span style="color:#E6E6E6"> (</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">) </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">  const</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6"> } </span><span style="color:#D4D4D4">=</span><span style="color:#9CDCFE"> elements</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#6A9955">  // same assertions as in the Vitest</span></span>
<span class="line"><span style="color:#C586C0">  await</span><span style="color:#DCDCAA"> expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toBeTruthy</span><span style="color:#E6E6E6">();</span></span>
<span class="line"><span style="color:#C586C0">  await</span><span style="color:#DCDCAA"> expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toHaveTextContent</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">label</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">};</span></span>
<span class="line"><span style="color:#C586C0">export</span><span style="color:#569CD6"> const</span><span style="color:#DCDCAA"> mouseInteraction</span><span style="color:#D4D4D4"> =</span><span style="color:#569CD6"> async</span><span style="color:#E6E6E6"> (</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">) </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">  const</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6"> } </span><span style="color:#D4D4D4">=</span><span style="color:#9CDCFE"> elements</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#6A9955">  // same user event as in the Vitest</span></span>
<span class="line"><span style="color:#C586C0">  await</span><span style="color:#9CDCFE"> userEvent</span><span style="color:#E6E6E6">.</span><span style="color:#DCDCAA">click</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">button</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#6A9955">  // same assertions as in the Vitest</span></span>
<span class="line"><span style="color:#C586C0">  await</span><span style="color:#DCDCAA"> expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">onClick</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toHaveBeenCalled</span><span style="color:#E6E6E6">();</span></span>
<span class="line"><span style="color:#C586C0">  await</span><span style="color:#DCDCAA"> expect</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">onClick</span><span style="color:#E6E6E6">).</span><span style="color:#DCDCAA">toHaveBeenCalledTimes</span><span style="color:#E6E6E6">(</span><span style="color:#B5CEA8">1</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">  await</span><span style="color:#9CDCFE"> args</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">onClick</span><span style="color:#E6E6E6">.</span><span style="color:#DCDCAA">mockClear</span><span style="color:#E6E6E6">();</span></span>
<span class="line"><span style="color:#E6E6E6">}</span></span>
<span class="line"></span></code></pre>
<p>Then integrating the shared-test methods in your Vitest would allow you to centralize all assertions for use in other testing systems. You’d only need to write the Vitest-specific containers with Vitest doing the component rendering.</p>
<pre class="astro-code slack-dark" style="background-color:#222222;color:#E6E6E6; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A9955">// button.test.js (updated)</span></span>
<span class="line"><span style="color:#C586C0">import</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">render</span><span style="color:#E6E6E6"> } </span><span style="color:#C586C0">from</span><span style="color:#CE9178"> '@testing-library/react'</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#C586C0">import</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">getElements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">ensureElements</span><span style="color:#E6E6E6"> } </span><span style="color:#C586C0">from</span><span style="color:#CE9178"> './button.shared-spec'</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#C586C0">import</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">vi</span><span style="color:#E6E6E6"> } </span><span style="color:#C586C0">from</span><span style="color:#CE9178"> 'vitest'</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#DCDCAA">describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'MeowButton'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">  const</span><span style="color:#9CDCFE"> props</span><span style="color:#D4D4D4"> =</span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#9CDCFE">    label:</span><span style="color:#CE9178"> 'meow'</span></span>
<span class="line"><span style="color:#9CDCFE">    onClick</span><span style="color:#E6E6E6">: </span><span style="color:#9CDCFE">vi</span><span style="color:#E6E6E6">.</span><span style="color:#DCDCAA">fn</span><span style="color:#E6E6E6">(),</span></span>
<span class="line"><span style="color:#E6E6E6">  };</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should have properly configured attributes'</span><span style="color:#E6E6E6">, </span><span style="color:#569CD6">async</span><span style="color:#E6E6E6"> () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> rendered</span><span style="color:#D4D4D4"> =</span><span style="color:#DCDCAA"> render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Button</span><span style="color:#569CD6"> {</span><span style="color:#D4D4D4">...</span><span style="color:#9CDCFE">props</span><span style="color:#569CD6">}</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> elements</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> getElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">rendered</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">container</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> ensureElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">props</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should respond to mouse interaction'</span><span style="color:#E6E6E6">, </span><span style="color:#569CD6">async</span><span style="color:#E6E6E6"> () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> rendered</span><span style="color:#D4D4D4"> =</span><span style="color:#DCDCAA"> render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Button</span><span style="color:#569CD6"> {</span><span style="color:#D4D4D4">...</span><span style="color:#9CDCFE">props</span><span style="color:#569CD6">}</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> elements</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> getElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">rendered</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">container</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> mouseInteraction</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">props</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#E6E6E6">});</span></span>
<span class="line"></span></code></pre>
<p>As a refresher on shared tests in Storybook - here are the shared-test methods in a Storybook story.</p>
<pre class="astro-code slack-dark" style="background-color:#222222;color:#E6E6E6; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A9955">// button.stories.js</span></span>
<span class="line"><span style="color:#C586C0">import</span><span style="color:#E6E6E6"> { </span><span style="color:#9CDCFE">getElements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">ensureElements</span><span style="color:#E6E6E6"> } </span><span style="color:#C586C0">from</span><span style="color:#CE9178"> './button.shared-spec'</span><span style="color:#E6E6E6">;</span></span>
<span class="line"><span style="color:#C586C0">export</span><span style="color:#569CD6"> const</span><span style="color:#9CDCFE"> MeowButton</span><span style="color:#D4D4D4"> =</span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#9CDCFE">  args:</span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#9CDCFE">    label:</span><span style="color:#CE9178"> 'meow'</span><span style="color:#E6E6E6">,</span></span>
<span class="line"><span style="color:#E6E6E6">  },</span></span>
<span class="line"><span style="color:#DCDCAA">  play</span><span style="color:#9CDCFE">:</span><span style="color:#569CD6"> async</span><span style="color:#E6E6E6"> ({ </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">canvasElement</span><span style="color:#E6E6E6"> }) </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> elements</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> getElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">canvasElement</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> ensureElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> mouseInteraction</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  },</span></span>
<span class="line"><span style="color:#E6E6E6">};</span></span>
<span class="line"></span></code></pre>
<p><strong>Important Points</strong></p>
<ul>
<li><code>rendered.container</code> is equivalent to <code>canvasElement</code> in that they are both an <code>HTMLElement</code> that contains the rendered component</li>
<li><code>getElements</code>, <code>mouseInteraction</code>, and <code>ensureElements</code> are the same functions used in Storybook’s <code>play</code> function</li>
</ul>
<h2 id="expand-the-concept-with-a-shared-test-suite">Expand the concept with a shared test suite!</h2>
<p>While the previous example may seem overbuilt, this concept is crazy-helpful when you have a lot of tests to write for a lot of different scenarios. A way to make this easier is to create a shared test suite method within your <code>test</code> file.</p>
<pre class="astro-code slack-dark" style="background-color:#222222;color:#E6E6E6; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#6A9955">// button.test.js (updated)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A9955">/**</span></span>
<span class="line"><span style="color:#6A9955"> * Uses the shared spec methods inside vitest test functions</span></span>
<span class="line"><span style="color:#6A9955"> * </span><span style="color:#569CD6">@param</span><span style="color:#9CDCFE"> Component</span><span style="color:#6A9955"> - OG component or a composed-via-storybook version</span></span>
<span class="line"><span style="color:#6A9955"> * </span><span style="color:#569CD6">@param</span><span style="color:#9CDCFE"> args</span><span style="color:#6A9955"> - props to pass to the component</span></span>
<span class="line"><span style="color:#6A9955"> */</span></span>
<span class="line"><span style="color:#569CD6">const</span><span style="color:#DCDCAA"> buttonTestSuite</span><span style="color:#D4D4D4"> =</span><span style="color:#E6E6E6"> (</span><span style="color:#9CDCFE">Component</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">) </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should have properly configured attributes'</span><span style="color:#E6E6E6">, </span><span style="color:#569CD6">async</span><span style="color:#E6E6E6"> () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> rendered</span><span style="color:#D4D4D4"> =</span><span style="color:#DCDCAA"> render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Component</span><span style="color:#569CD6"> {</span><span style="color:#D4D4D4">...</span><span style="color:#9CDCFE">args</span><span style="color:#569CD6">}</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> elements</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> getElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">rendered</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">container</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> ensureElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should respond to mouse interaction'</span><span style="color:#E6E6E6">, </span><span style="color:#569CD6">async</span><span style="color:#E6E6E6"> () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> rendered</span><span style="color:#D4D4D4"> =</span><span style="color:#DCDCAA"> render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Component</span><span style="color:#569CD6"> {</span><span style="color:#D4D4D4">...</span><span style="color:#9CDCFE">args</span><span style="color:#569CD6">}</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> elements</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> getElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">rendered</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">container</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> mouseInteraction</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#DCDCAA">  it</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'should respond to keyboard interaction'</span><span style="color:#E6E6E6">, </span><span style="color:#569CD6">async</span><span style="color:#E6E6E6"> () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> rendered</span><span style="color:#D4D4D4"> =</span><span style="color:#DCDCAA"> render</span><span style="color:#E6E6E6">(</span><span style="color:#808080">&#x3C;</span><span style="color:#4EC9B0">Component</span><span style="color:#569CD6"> {</span><span style="color:#D4D4D4">...</span><span style="color:#9CDCFE">args</span><span style="color:#569CD6">}</span><span style="color:#808080"> /></span><span style="color:#E6E6E6">)</span></span>
<span class="line"><span style="color:#569CD6">    const</span><span style="color:#9CDCFE"> elements</span><span style="color:#D4D4D4"> =</span><span style="color:#C586C0"> await</span><span style="color:#DCDCAA"> getElements</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">rendered</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">container</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#C586C0">    await</span><span style="color:#DCDCAA"> keyboardInteraction</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">elements</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#E6E6E6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA">describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'Button'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">  describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'Primary'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">    buttonTestSuite</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">Primary</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">Primary</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#DCDCAA">  describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'Secondary'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">    buttonTestSuite</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">Secondary</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">Secondary</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#DCDCAA">  describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'Large'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">    buttonTestSuite</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">Large</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">Large</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#DCDCAA">  describe</span><span style="color:#E6E6E6">(</span><span style="color:#CE9178">'Small'</span><span style="color:#E6E6E6">, () </span><span style="color:#569CD6">=></span><span style="color:#E6E6E6"> {</span></span>
<span class="line"><span style="color:#DCDCAA">    buttonTestSuite</span><span style="color:#E6E6E6">(</span><span style="color:#9CDCFE">Small</span><span style="color:#E6E6E6">, </span><span style="color:#9CDCFE">Small</span><span style="color:#E6E6E6">.</span><span style="color:#9CDCFE">args</span><span style="color:#E6E6E6">);</span></span>
<span class="line"><span style="color:#E6E6E6">  });</span></span>
<span class="line"><span style="color:#E6E6E6">});</span></span>
<span class="line"></span></code></pre>
<p>The above will test each permutation of Button in the same way, and you can add as many test examples as you want without having to repeat yourself or excessively increasing the size of the file.</p>
<p>Verbose-output coverage would look like this:</p>
<pre class="astro-code slack-dark" style="background-color:#222222;color:#E6E6E6; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#DCDCAA">✓</span><span style="color:#CE9178"> src/stories/Button.test.jsx</span><span style="color:#E6E6E6"> (12)</span></span>
<span class="line"><span style="color:#DCDCAA">  ✓</span><span style="color:#CE9178"> Button</span><span style="color:#E6E6E6"> (12)</span></span>
<span class="line"><span style="color:#DCDCAA">    ✓</span><span style="color:#CE9178"> Primary</span><span style="color:#E6E6E6"> (3)</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> have</span><span style="color:#CE9178"> properly</span><span style="color:#CE9178"> configured</span><span style="color:#CE9178"> attributes</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> respond</span><span style="color:#CE9178"> to</span><span style="color:#CE9178"> mouse</span><span style="color:#CE9178"> interaction</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> respond</span><span style="color:#CE9178"> to</span><span style="color:#CE9178"> keyboard</span><span style="color:#CE9178"> interaction</span></span>
<span class="line"><span style="color:#DCDCAA">    ✓</span><span style="color:#CE9178"> Secondary</span><span style="color:#E6E6E6"> (3)</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> have</span><span style="color:#CE9178"> properly</span><span style="color:#CE9178"> configured</span><span style="color:#CE9178"> attributes</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> respond</span><span style="color:#CE9178"> to</span><span style="color:#CE9178"> mouse</span><span style="color:#CE9178"> interaction</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> respond</span><span style="color:#CE9178"> to</span><span style="color:#CE9178"> keyboard</span><span style="color:#CE9178"> interaction</span></span>
<span class="line"><span style="color:#DCDCAA">    ✓</span><span style="color:#CE9178"> Large</span><span style="color:#E6E6E6"> (3)</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> have</span><span style="color:#CE9178"> properly</span><span style="color:#CE9178"> configured</span><span style="color:#CE9178"> attributes</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> respond</span><span style="color:#CE9178"> to</span><span style="color:#CE9178"> mouse</span><span style="color:#CE9178"> interaction</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> respond</span><span style="color:#CE9178"> to</span><span style="color:#CE9178"> keyboard</span><span style="color:#CE9178"> interaction</span></span>
<span class="line"><span style="color:#DCDCAA">    ✓</span><span style="color:#CE9178"> Small</span><span style="color:#E6E6E6"> (3)</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> have</span><span style="color:#CE9178"> properly</span><span style="color:#CE9178"> configured</span><span style="color:#CE9178"> attributes</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> respond</span><span style="color:#CE9178"> to</span><span style="color:#CE9178"> mouse</span><span style="color:#CE9178"> interaction</span></span>
<span class="line"><span style="color:#DCDCAA">      ✓</span><span style="color:#CE9178"> should</span><span style="color:#CE9178"> respond</span><span style="color:#CE9178"> to</span><span style="color:#CE9178"> keyboard</span><span style="color:#CE9178"> interaction</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DCDCAA">Test</span><span style="color:#CE9178"> Files</span><span style="color:#B5CEA8">  1</span><span style="color:#CE9178"> passed</span><span style="color:#E6E6E6"> (1)</span></span>
<span class="line"><span style="color:#DCDCAA">    Tests</span><span style="color:#B5CEA8">  12</span><span style="color:#CE9178"> passed</span><span style="color:#E6E6E6"> (12)</span></span>
<span class="line"><span style="color:#DCDCAA">  Start</span><span style="color:#CE9178"> at</span><span style="color:#CE9178">  16:07:51</span></span>
<span class="line"><span style="color:#DCDCAA">  Duration</span><span style="color:#CE9178">  1.38s</span><span style="color:#E6E6E6"> (transform </span><span style="color:#CE9178">188ms,</span><span style="color:#CE9178"> setup</span><span style="color:#CE9178"> 159ms,</span><span style="color:#CE9178"> collect</span><span style="color:#CE9178"> 293ms,</span><span style="color:#CE9178"> tests</span><span style="color:#CE9178"> 118ms,</span><span style="color:#CE9178"> environment</span><span style="color:#CE9178"> 345ms,</span><span style="color:#CE9178"> prepare</span><span style="color:#CE9178"> 85ms</span><span style="color:#E6E6E6">)</span></span>
<span class="line"></span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Sharing tests between Storybook and your application’s test suite could be seen as a niche-need … however, looking at your testing in a more programatic way will:</p>
<ul>
<li>keep your test suites DRY</li>
<li>allow a single source of truth for your test assertions</li>
<li><strong>allow you to change UI frameworks, but keep the same UX</strong> (to be explained in part 4, <em>Sharing Tests Between Javascript Frameworks</em>)</li>
</ul> </div> </article>  </main> <footer data-astro-cid-sz7xmlte style="--navBorder: #ffd273;"> <nav data-astro-cid-sz7xmlte style="--navBorder: #ffd273;"> <a href="/" data-astro-cid-sz7xmlte style="--navBorder: #ffd273;">home</a> <a href="/whoami" data-astro-cid-sz7xmlte style="--navBorder: #ffd273;">whoami</a> <a href="/blahg" data-astro-cid-sz7xmlte style="--navBorder: #ffd273;">blahg</a> <a href="/resume" data-astro-cid-sz7xmlte style="--navBorder: #ffd273;">resume</a> <a href="/rss.xml" target="_blank" data-astro-cid-sz7xmlte style="--navBorder: #ffd273;">rss feed</a> </nav> <p data-astro-cid-sz7xmlte style="--navBorder: #ffd273;">&copy; 2001-2024&nbsp;Scott Nath All rights reserved.</p> <div data-astro-cid-mtzrixcv style="--navBorder: #ffd273;"> <p data-astro-cid-mtzrixcv style="--navBorder: #ffd273;">CS.Sjoy.lol <a href="https://cs.sjoy.lol" data-astro-cid-mtzrixcv style="--navBorder: #ffd273;">webring</a></p> <div data-astro-cid-mtzrixcv style="--navBorder: #ffd273;"> <a href="https://webri.ng/webring/cssjoy/previous?via=https://scottnath.com" aria-label="previous site" data-astro-cid-mtzrixcv style="--navBorder: #ffd273;">← Prev</a> <a href="https://webri.ng/webring/cssjoy/random?via=https://scottnath.com" aria-label="random site" data-astro-cid-mtzrixcv style="--navBorder: #ffd273;">🎲</a> <a href="https://webri.ng/webring/cssjoy/next?via=https://scottnath.com" aria-label="next site" data-astro-cid-mtzrixcv style="--navBorder: #ffd273;">Next →</a> </div> </div>  <a href="/" class="you-still-here" title="You're still here? Go Home" data-astro-cid-sz7xmlte style="--navBorder: #ffd273;"><img src="/ferris-end-scene.avif" loading="lazy" width="381" height="177" alt="You're still here? (Screen shot from Ferris Bueller's Day Off)" data-astro-cid-sz7xmlte style="--navBorder: #ffd273;"></a> </footer>  </body></html>