<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-B00ZXZSE29" type="text/partytown"></script>
<script type="text/partytown">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-B00ZXZSE29');
</script>

<!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/svg+xml" href="/favicon.svg">
<meta name="generator" content="Astro v2.3.0">

<!-- Canonical URL -->
<link rel="canonical" href="https://scottnath.com/blahg/sharing-tests-between-vitest-and-storybook/">

<!-- Primary Meta Tags -->
<title>Sharing Interaction Tests Between Vitest and Storybook</title>
<meta name="title" content="Sharing Interaction Tests Between Vitest and Storybook">
<meta name="description" content="How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite's native test runner.">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://scottnath.com/blahg/sharing-tests-between-vitest-and-storybook/">
<meta property="og:title" content="Sharing Interaction Tests Between Vitest and Storybook">
<meta property="og:description" content="How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite's native test runner.">
<meta property="og:image" content="https://scottnath.com/vitest-shared-tests-basic.png">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://scottnath.com/blahg/sharing-tests-between-vitest-and-storybook/">
<meta property="twitter:title" content="Sharing Interaction Tests Between Vitest and Storybook">
<meta property="twitter:description" content="How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite's native test runner.">
<meta property="twitter:image" content="https://scottnath.com/vitest-shared-tests-basic.png">
	<link rel="stylesheet" href="/_astro/_...slug_.6d68f6fb.css" /><script>!(function(w,p,f,c){c=w[p]=Object.assign(w[p]||{},{"lib":"/~partytown/","debug":false});c[f]=(c[f]||[]).concat(["dataLayer.push"])})(window,'partytown','forward');/* Partytown 0.7.6 - MIT builder.io */
!function(t,e,n,i,r,o,a,d,s,c,p,l){function u(){l||(l=1,"/"==(a=(o.lib||"/~partytown/")+(o.debug?"debug/":""))[0]&&(s=e.querySelectorAll('script[type="text/partytown"]'),i!=t?i.dispatchEvent(new CustomEvent("pt1",{detail:t})):(d=setTimeout(f,1e4),e.addEventListener("pt0",w),r?h(1):n.serviceWorker?n.serviceWorker.register(a+(o.swPath||"partytown-sw.js"),{scope:a}).then((function(t){t.active?h():t.installing&&t.installing.addEventListener("statechange",(function(t){"activated"==t.target.state&&h()}))}),console.error):f())))}function h(t){c=e.createElement(t?"script":"iframe"),t||(c.setAttribute("style","display:block;width:0;height:0;border:0;visibility:hidden"),c.setAttribute("aria-hidden",!0)),c.src=a+"partytown-"+(t?"atomics.js?v=0.7.6":"sandbox-sw.html?"+Date.now()),e.body.appendChild(c)}function f(n,r){for(w(),i==t&&(o.forward||[]).map((function(e){delete t[e.split(".")[0]]})),n=0;n<s.length;n++)(r=e.createElement("script")).innerHTML=s[n].innerHTML,e.head.appendChild(r);c&&c.parentNode.removeChild(c)}function w(){clearTimeout(d)}o=t.partytown||{},i==t&&(o.forward||[]).map((function(e){p=t,e.split(".").map((function(e,n,i){p=p[i[n]]=n+1<i.length?"push"==i[n+1]?[]:p[i[n]]||{}:function(){(t._ptf=t._ptf||[]).push(i,arguments)}}))})),"complete"==e.readyState?u():(t.addEventListener("DOMContentLoaded",u),t.addEventListener("load",u))}(window,document,navigator,top,window.crossOriginIsolated);</script></head>

	<body>
		<header class="astro-3EF6KSR2">
	<h2 class="astro-3EF6KSR2">
		Scott Nath
	</h2>
	<nav class="astro-3EF6KSR2">
		<a href="/" class="astro-3EF6KSR2 astro-EIMMU3LG">
	Home
</a>
		<a href="/blahg" class="astro-3EF6KSR2 astro-EIMMU3LG">
	Blahg
</a>
		<a href="/resume" class="astro-3EF6KSR2 astro-EIMMU3LG">
	Resume
</a>
	</nav>
</header>
		<main>
      
	<article>
		<img width="720" height="360" src="/vitest-shared-tests-basic.png" alt="">
		<h1 class="title">Sharing Interaction Tests Between Vitest and Storybook</h1>
		<time datetime="2023-06-08T00:00:00.000Z">
	Jun 8, 2023
</time>
		
		<hr>
		
	<p>How to use the same testing-library UI tests for Storybook Interaction testing and Vitest, Vite’s native test runner.</p>
<h2 id="tldr">tl;dr</h2>
<p>Tests can be shared between Vitest tests (<code>*.test.js</code>) and Storybook stories’ <code>play</code> tests by using shared test files (<code>*.shared-spec.js</code>).</p>
<p>Replace all assertions:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Meow component'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should meow'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">thing1</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">thing2</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">thing3</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">thing4</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Meow</span><span style="color: #C9D1D9"> />);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(thing1).</span><span style="color: #D2A8FF">toBe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'some assertion 1'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(thing2).</span><span style="color: #D2A8FF">toBe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'some assertion 2'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(thing3).</span><span style="color: #D2A8FF">toBe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'some assertion 3'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(thing4).</span><span style="color: #D2A8FF">toBe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'some assertion 4'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">  })</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<p>With shared tests:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Meow component'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should meow'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">sharedTests</span><span style="color: #C9D1D9">(</span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Meow</span><span style="color: #C9D1D9"> />), Meow.props)</span></span>
<span class="line"><span style="color: #C9D1D9">  })</span></span>
<span class="line"><span style="color: #C9D1D9">})</span></span></code></pre>
<details>
<summary>Series: Sharing tests across UI components</summary>
<ul>
<li><a href="part1">PART 1: Reusable Storybook Interaction Tests</a></li>
<li><a href="part2">PART 2: Sharing Interaction Tests Between Components</a></li>
</ul>
</details>
<details>
<summary>Prerequisite knowledge</summary>
<ul>
<li><a href="https://storybook.js.org/docs/react/writing-tests/interaction-testing">Storybook interactive tests</a></li>
<li><a href="https://testing-library.com">Testing Library</a></li>
<li><a href="https://vitest.dev/">Vitest</a></li>
</ul>
</details>
<h2 id="why-share-tests-between-storybook-and-unit-tests">Why share tests between Storybook and Unit tests?</h2>
<p>Time and money!</p>
<p>…and coverage reporting requirements…and trust issues…</p>
<ul>
<li>If your Continuous Integration system does not allow the installation of Playwright or running a browser, <code>test-storybook</code> cannot be used in CI to test your components</li>
<li>If your coverage tool does not support Storybook’s <code>play</code> or <code>smoke</code> tests, but you’re already writing Interactive tests in Storybook</li>
<li>If you (or your Dev team) prefer not to rely solely on Storybook as your only test suite</li>
<li>If you want <strong>a single source of truth for your component’s tests</strong></li>
</ul>
<h2 id="shared-tests-and-how-to-use-them">Shared tests and how to use them</h2>
<p>Staying D.R.Y. so… see <a href="/blahg/shared-storybook-tests/">part 1</a> and <a href="/blahg/sharing-tests-between-components/">part 2</a> of the shared tests series for details.</p>
<h2 id="basic-example-of-shared-spec-tests-being-used-in-vitest">Basic example of shared-spec tests being used in Vitest</h2>
<p>Take a basic Vitest for a button:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// button.test.js</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { render } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'@testing-library/react'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> userEvent </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'@testing-library/user-event'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { vi } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'vitest'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'MeowButton'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">props</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    label: </span><span style="color: #A5D6FF">'meow'</span></span>
<span class="line"><span style="color: #C9D1D9">    onClick: vi.</span><span style="color: #D2A8FF">fn</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">  };</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should have properly configured attributes'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">queryByRole</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Button</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">{...</span><span style="color: #C9D1D9">props</span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> />)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">button</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">queryByRole</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'button'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(button).</span><span style="color: #D2A8FF">toBeTruthy</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(button).</span><span style="color: #D2A8FF">toHaveTextContent</span><span style="color: #C9D1D9">(props.label);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should respond to mouse interaction'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">queryByRole</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Button</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">{...</span><span style="color: #C9D1D9">props</span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> />)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">button</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">queryByRole</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'button'</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> userEvent.</span><span style="color: #D2A8FF">click</span><span style="color: #C9D1D9">(button);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(args.onClick).</span><span style="color: #D2A8FF">toHaveBeenCalled</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(args.onClick).</span><span style="color: #D2A8FF">toHaveBeenCalledTimes</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> args.onClick.</span><span style="color: #D2A8FF">mockClear</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>If you have shared-test methods like this:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// button.shared-spec.js</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { within, userEvent } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'@storybook/testing-library'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">export</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">getElements</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">canvasElement</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">button</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">within</span><span style="color: #C9D1D9">(canvasElement).</span><span style="color: #D2A8FF">findByRole</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'button'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> { button };</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span>
<span class="line"><span style="color: #FF7B72">export</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ensureElements</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">elements</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">args</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">button</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> elements;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// same assertions as in the Vitest</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(button).</span><span style="color: #D2A8FF">toBeTruthy</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(button).</span><span style="color: #D2A8FF">toHaveTextContent</span><span style="color: #C9D1D9">(args.label);</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span>
<span class="line"><span style="color: #FF7B72">export</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mouseInteraction</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">elements</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">args</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> { </span><span style="color: #79C0FF">button</span><span style="color: #C9D1D9"> } </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> elements;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// same user event as in the Vitest</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> userEvent.</span><span style="color: #D2A8FF">click</span><span style="color: #C9D1D9">(button);</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// same assertions as in the Vitest</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(args.onClick).</span><span style="color: #D2A8FF">toHaveBeenCalled</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">expect</span><span style="color: #C9D1D9">(args.onClick).</span><span style="color: #D2A8FF">toHaveBeenCalledTimes</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> args.onClick.</span><span style="color: #D2A8FF">mockClear</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>Then integrating the shared-test methods in your Vitest would allow you to centralize all assertions for use in other testing systems. You’d only need to write the Vitest-specific containers with Vitest doing the component rendering.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// button.test.js (updated)</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { render } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'@testing-library/react'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { getElements, ensureElements } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'./button.shared-spec'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { vi } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'vitest'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'MeowButton'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">props</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    label: </span><span style="color: #A5D6FF">'meow'</span></span>
<span class="line"><span style="color: #C9D1D9">    onClick: vi.</span><span style="color: #D2A8FF">fn</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">  };</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should have properly configured attributes'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">rendered</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Button</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">{...</span><span style="color: #C9D1D9">props</span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> />)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">elements</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">getElements</span><span style="color: #C9D1D9">(rendered.container);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ensureElements</span><span style="color: #C9D1D9">(elements, props);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should respond to mouse interaction'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">rendered</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Button</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">{...</span><span style="color: #C9D1D9">props</span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> />)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">elements</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">getElements</span><span style="color: #C9D1D9">(rendered.container);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mouseInteraction</span><span style="color: #C9D1D9">(elements, props);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>As a refresher on shared tests in Storybook - here are the shared-test methods in a Storybook story.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// button.stories.js</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> { getElements, ensureElements } </span><span style="color: #FF7B72">from</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'./button.shared-spec'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">export</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">MeowButton</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  args: {</span></span>
<span class="line"><span style="color: #C9D1D9">    label: </span><span style="color: #A5D6FF">'meow'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">  },</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">play</span><span style="color: #C9D1D9">: </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> ({ </span><span style="color: #FFA657">args</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">canvasElement</span><span style="color: #C9D1D9"> }) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">elements</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">getElements</span><span style="color: #C9D1D9">(canvasElement);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ensureElements</span><span style="color: #C9D1D9">(elements, args);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mouseInteraction</span><span style="color: #C9D1D9">(elements, args);</span></span>
<span class="line"><span style="color: #C9D1D9">  },</span></span>
<span class="line"><span style="color: #C9D1D9">};</span></span></code></pre>
<p><strong>Important Points</strong></p>
<ul>
<li><code>rendered.container</code> is equivalent to <code>canvasElement</code> in that they are both an <code>HTMLElement</code> that contains the rendered component</li>
<li><code>getElements</code>, <code>mouseInteraction</code>, and <code>ensureElements</code> are the same functions used in Storybook’s <code>play</code> function</li>
</ul>
<h2 id="expand-the-concept-with-a-shared-test-suite">Expand the concept with a shared test suite!</h2>
<p>While the previous example may seem overbuilt, this concept is crazy-helpful when you have a lot of tests to write for a lot of different scenarios. A way to make this easier is to create a shared test suite method within your <code>test</code> file.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #8B949E">// button.test.js (updated)</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">/**</span></span>
<span class="line"><span style="color: #8B949E"> * Uses the shared spec methods inside vitest test functions</span></span>
<span class="line"><span style="color: #8B949E"> * </span><span style="color: #FF7B72">@param</span><span style="color: #8B949E"> </span><span style="color: #C9D1D9">Component</span><span style="color: #8B949E"> - OG component or a composed-via-storybook version</span></span>
<span class="line"><span style="color: #8B949E"> * </span><span style="color: #FF7B72">@param</span><span style="color: #8B949E"> </span><span style="color: #C9D1D9">args</span><span style="color: #8B949E"> - props to pass to the component</span></span>
<span class="line"><span style="color: #8B949E"> */</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">buttonTestSuite</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">Component</span><span style="color: #C9D1D9">, </span><span style="color: #FFA657">args</span><span style="color: #C9D1D9">) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should have properly configured attributes'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">rendered</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Component</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">{...</span><span style="color: #C9D1D9">args</span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> />)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">elements</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">getElements</span><span style="color: #C9D1D9">(rendered.container);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">ensureElements</span><span style="color: #C9D1D9">(elements, args);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should respond to mouse interaction'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">rendered</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Component</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">{...</span><span style="color: #C9D1D9">args</span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> />)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">elements</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">getElements</span><span style="color: #C9D1D9">(rendered.container);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">mouseInteraction</span><span style="color: #C9D1D9">(elements, args);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">it</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'should respond to keyboard interaction'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">rendered</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">render</span><span style="color: #C9D1D9">(&#x3C;</span><span style="color: #7EE787">Component</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">{...</span><span style="color: #C9D1D9">args</span><span style="color: #FF7B72">}</span><span style="color: #C9D1D9"> />)</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">elements</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">getElements</span><span style="color: #C9D1D9">(rendered.container);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">keyboardInteraction</span><span style="color: #C9D1D9">(elements, args);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Button'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Primary'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">buttonTestSuite</span><span style="color: #C9D1D9">(Primary, Primary.args);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Secondary'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">buttonTestSuite</span><span style="color: #C9D1D9">(Secondary, Secondary.args);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Large'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">buttonTestSuite</span><span style="color: #C9D1D9">(Large, Large.args);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">describe</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Small'</span><span style="color: #C9D1D9">, () </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">buttonTestSuite</span><span style="color: #C9D1D9">(Small, Small.args);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>The above will test each permutation of Button in the same way, and you can add as many test examples as you want without having to repeat yourself or excessively increasing the size of the file.</p>
<p>Verbose-output coverage would look like this:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">✓ src/stories/Button.test.jsx (12)</span></span>
<span class="line"><span style="color: #C9D1D9">  ✓ Button (12)</span></span>
<span class="line"><span style="color: #C9D1D9">    ✓ Primary (3)</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should have properly configured attributes</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should respond to mouse interaction</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should respond to keyboard interaction</span></span>
<span class="line"><span style="color: #C9D1D9">    ✓ Secondary (3)</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should have properly configured attributes</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should respond to mouse interaction</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should respond to keyboard interaction</span></span>
<span class="line"><span style="color: #C9D1D9">    ✓ Large (3)</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should have properly configured attributes</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should respond to mouse interaction</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should respond to keyboard interaction</span></span>
<span class="line"><span style="color: #C9D1D9">    ✓ Small (3)</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should have properly configured attributes</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should respond to mouse interaction</span></span>
<span class="line"><span style="color: #C9D1D9">      ✓ should respond to keyboard interaction</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">Test Files  1 passed (1)</span></span>
<span class="line"><span style="color: #C9D1D9">    Tests  12 passed (12)</span></span>
<span class="line"><span style="color: #C9D1D9">  Start at  16:07:51</span></span>
<span class="line"><span style="color: #C9D1D9">  Duration  1.38s (transform 188ms, setup 159ms, collect 293ms, tests 118ms, environment 345ms, prepare 85ms)</span></span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Sharing tests between Storybook and your application’s test suite could be seen as a niche-need … however, looking at your testing in a more programatic way will:</p>
<ul>
<li>keep your test suites DRY</li>
<li>allow a single source of truth for your test assertions</li>
<li><strong>allow you to change UI frameworks, but keep the same UX</strong> (to be explained in part 4, <em>Sharing Tests Between Javascript Frameworks</em>)</li>
</ul>

	</article>

		</main>
		<footer class="astro-SZ7XMLTE">
	<hr class="astro-SZ7XMLTE">
	&copy; 2023 Scott Nath All rights reserved.
</footer>
	</body></html>